<html><head><base href="/" />
    <meta charset="UTF-8">
    <title>Juzgado Vial Zona Este</title>
    <link rel="shortcut icon" href="./caraFeliz.jpg" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    
    <style>
    :root {
      --primary-blue: #00BCD4;
      --secondary-blue: #0097A7;
      --primary-green: #4CAF50;
      --secondary-green: #388E3C;
      --primary-orange: #FF9800;
      --secondary-orange: #F57C00;
    }
    
    /* Estilos generales */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f0f2f5;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .header {
        background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
        color: white;
        padding: 20px;
        text-align: center;
        border-radius: 8px;
        margin-bottom: 30px;
    }
    
    .search-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        max-width: 80%;
        margin-left: auto;
        margin-right: auto;
    }
    
    .search-container .form-group {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .search-container input {
        flex: 1;
    }
    
    .search-container button {
        margin-top: 0;
    }
    
    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .tab-button {
        padding: 10px 20px;
        border: none;
        background: var(--primary-orange);
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
    }
    
    .tab-button:hover {
        background: var(--secondary-orange);
    }
    
    .tab-button.active {
        background: var(--secondary-blue);
    }
    
    .form-container {
        max-width: 80%;
        margin: 0 auto;
    }
    
    .form-group {
        margin-bottom: 20px;
        max-width: 100%;
    }
    
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    
    input, select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    button {
        background: var(--primary-green);
        color: white;
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    button:hover {
        background: var(--secondary-green);
    }
    
    .edit-button {
        background: #2196F3;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .edit-button:hover {
        background: #1976D2;
    }
    
    .delete-button {
        background: #dc3545;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 5px;
    }
    
    .delete-button:hover {
        background: #c82333;
    }
    
    .table-container {
        margin-top: 40px;
        overflow-x: auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    
    th {
        background: var(--primary-blue);
        color: white;
        margin: 10px 0;
    }
    
    .export-buttons {
        margin-top: 20px;
        display: flex;
        gap: 10px;
    }
    
    /* Add to existing CSS */
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
    }
    
    .participante-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: flex-start;
    }
    
    .participante-row input {
        flex: 1;
    }
    
    .remove-participante {
        background: #dc3545;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .secondary-button {
        background: var(--primary-blue);
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
    }
    
    .participantes-list {
        font-size: 0.9em;
        color: #666;
        margin-top: 5px;
    }
    
    /* Update responsive CSS */
    @media (max-width: 768px) {
        .container {
            padding: 10px;
        }
        
        .tabs {
            flex-direction: column;
        }
        
        .form-container,
        .search-container {
            max-width: 95%;
        }
        
        .search-container .form-group {
            flex-direction: column;
            gap: 15px;
        }
    
        .form-row {
            flex-direction: column;
            gap: 15px;
        }
        
        .search-container button {
            width: 100%;
        }
        
        .export-buttons {
            flex-direction: column;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            font-size: 14px;
        }
    }
    
    /* Additional table responsiveness */
    @media (max-width: 480px) {
        th, td {
            padding: 8px;
            font-size: 12px;
        }
        
        .header h1 {
            font-size: 24px;
        }
    }
    
    .table-container a {
        color: #2196F3;
        text-decoration: none;
        margin-right: 5px;
    }
    
    .table-container a:hover {
        text-decoration: underline;
    }
    
    .table-container td:last-child {
        white-space: nowrap;
    }
    
    #accidentesTable tbody tr.esperando-audiencia {
        background-color: #ffffff; /* white */
    }
    
    #accidentesTable tbody tr.esperando-cedula {
        background-color: #fff3cd; /* yellow */
    }
    
    #accidentesTable tbody tr.apremio {
        background-color: #f8d7da; /* red */
    }
    
    #accidentesTable tbody tr.pagado {
        background-color: #8bc34a; /* darker green */
    }
    
    #accidentesTable tbody tr.finalizado {
        background-color: #cce5ff; /* light blue */
    }
    
    #accidentesTable tbody tr.remitido {
        background-color: #ffd4d4; /* light red */
    }
    
    #actasTable tbody tr.esperando-cedula {
        background-color: #fff3cd; /* yellow */
    }
    
    #actasTable tbody tr.apremio {
        background-color: #f8d7da; /* red */
    }
    
    #actasTable tbody tr.pagado {
        background-color: #8bc34a; /* darker green */
    }
    
    #actasTable tbody tr.remitida {
        background-color: #ffd4d4; /* light red */
    }
    
    .alcoholemia-alert {
        color: red;
        font-weight: bold;
    }
    
    .pay-button {
        background: #4CAF50;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .payment-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.8);
        z-index: 1000;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .payment-content {
        background: white;
        padding: 30px;
        border-radius: 8px;
        width: 90%;
        max-width: 600px;
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .payment-details {
        margin: 20px 0;
    }
    
    .payment-form {
        border: 1px solid #ddd;
        padding: 20px;
        margin: 20px 0;
    }
    
    .payment-total {
        font-size: 24px;
        font-weight: bold;
        margin: 20px 0;
    }
    
    .print-button {
        background: #2196F3;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 10px;
    }
    
    .barcode-container {
        text-align: center;
        margin: 20px 0;
        padding: 10px;
        background: white;
    }
    
    .barcode-container svg {
        max-width: 100%;
    }
    
    @media print {
        body * {
            visibility: hidden;
        }
        .payment-content, .payment-content * {
            visibility: visible;
        }
        .payment-content {
            position: absolute;
            left: 0;
            top: 0;
        }
        .payment-form, .print-button, .payment-content > button:last-child {
            display: none !important;  
        }
        .barcode-container {
            display: block !important;
            visibility: visible !important;
            margin-bottom: 30px;
        }
     
    }
    
    #montoAPagar {
        font-size: 24px;
        font-weight: bold;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
    }
    </style>
    
    <div class="container">
        <div class="header">
            <h1>Juzgado Vial Zona Este</h1>
        </div>
    
        <div class="search-container">
            <h2>Buscar</h2>
            <div class="form-group">
                <input type="text" id="searchInput" placeholder="Ingrese DNI, Dominio, N√∫mero de Acta o N√∫mero de Accidente">
                <button onclick="buscarRegistros()">Buscar</button>
            </div>
            <div id="searchResults"></div>
        </div>
    
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('accidentes')">Accidentes Viales</button>
            <button class="tab-button" onclick="showTab('actas')">Actas</button>
        </div>
    
        <div id="accidentes" class="tab-content">
            <div class="form-container">
                <h2>Registro de Accidente Vial</h2>
                <form id="accidenteForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>N√∫mero de Accidente:</label>
                            <input type="text" id="numeroAccidente" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre y Apellido:</label>
                            <input type="text" id="nombreAccidente" required>
                        </div>
                        <div class="form-group">
                            <label>DNI:</label>
                            <input type="text" id="dniAccidente" required>
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha del Accidente:</label>
                            <input type="date" id="fechaAccidente" required>
                        </div>
                        <div class="form-group">
                            <label>Lugar del Hecho:</label>
                            <input type="text" id="lugarAccidente" required>
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Dominio:</label>
                            <input type="text" id="dominioAccidente" required>
                        </div>
                        <div class="form-group">
                            <label>Fecha de Audiencia:</label>
                            <input type="date" id="fechaAudiencia" required>
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Asignada a:</label>
                            <select id="asignadaA">
                                <option>Ivan</option>
                                <option>Hugo</option>
                                <option>Patricia</option>
                                <option>Daniel</option>
                                <option>Carolina</option>
                                <option>Gabriela</option>
                                <option>Otro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Accidente:</label>
                            <select id="tipoAccidente">
                                <option>Com√∫n</option>
                                <option>Emplace</option>
                                <option>Archivo</option>
                                <option>Otro</option>
                            </select>
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Estado del Accidente:</label>
                            <select id="estadoAccidente">
                                <option>Esperando Audiencia</option>
                                <option>Esperando Cedula</option>
                                <option>Apremio</option>
                                <option>Pagado</option>
                                <option>Finalizado</option>
                                <option>Remitido</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Fallo (PDF):</label>
                            <input type="file" id="falloPdf" accept=".pdf">
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valor de la Multa:</label>
                            <input type="number" id="valorMultaAccidente" required>
                        </div>
                    </div>
    
                    <div class="form-group">
                        <label>Participantes Adicionales:</label>
                        <div id="participantesContainer">
                        </div>
                        <button type="button" onclick="agregarParticipante()" class="secondary-button">+ Agregar Participante</button>
                    </div>
    
                    <button type="submit">Guardar Accidente</button>
                </form>
            </div>
    
            <div class="table-container">
                <h3>Registro de Accidentes</h3>
                <table id="accidentesTable">
                    <thead>
                        <tr>
                            <th>N√∫mero de Accidente</th>
                            <th>Nombre y Apellido</th>
                            <th>DNI</th>
                            <th>Fecha</th>
                            <th>Lugar</th>
                            <th>Dominio</th>
                            <th>Fecha Audiencia</th>
                            <th>Asignada</th>
                            <th>Tipo</th>
                            <th>Estado</th>
                            <th>Valor de Multa</th>
                            <th>Fallo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="export-buttons">
                    <button onclick="exportToExcel('accidentes')">Exportar a Excel</button>
                    <button onclick="exportToPDF('accidentes')">Exportar a PDF</button>
                </div>
            </div>
        </div>
    
        <div id="actas" class="tab-content" style="display: none;">
            <div class="form-container">
                <h2>Registro de Acta</h2>
                <form id="actaForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>N√∫mero de Acta:</label>
                            <input type="text" id="numeroActa" required>
                        </div>
                        <div class="form-group">
                            <label>Nombre y Apellido:</label>
                            <input type="text" id="nombreActa" required>
                        </div>
                        <div class="form-group">
                            <label>DNI:</label>
                            <input type="text" id="dniActa" required>
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha del Acta:</label>
                            <input type="date" id="fechaActa" required>
                        </div>
                        <div class="form-group">
                            <label>Dominio:</label>
                            <input type="text" id="dominioActa" required>
                        </div>
                        <div class="form-group">
                            <label>Alcoholemia:</label>
                            <select id="alcoholemiaActa">
                                <option value="No">No</option>
                                <option value="S√≠">S√≠</option>
                            </select>
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo de Infracci√≥n:</label>
                            <input type="text" id="tipoInfraccion" required>
                        </div>
                        <div class="form-group">
                            <label>¬øCon Secuestro?</label>
                            <select id="conSecuestro">
                                <option value="No">No</option>
                                <option value="S√≠">S√≠</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estado del Acta:</label>
                            <select id="estadoActa">
                                <option>Esperando Cedula</option>
                                <option>Apremio</option>
                                <option>Pagado</option>
                                <option>Remitida</option>
                            </select>
                        </div>
                    </div>
    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valor de la Multa:</label>
                            <input type="number" id="valorMulta" required>
                        </div>
                    </div>
    
                    <button type="submit">Guardar Acta</button>
                </form>
            </div>
    
            <div class="table-container">
                <h3>Registro de Actas</h3>
                <table id="actasTable">
                    <thead>
                        <tr>
                            <th>N√∫mero de Acta</th>
                            <th>Nombre y Apellido</th>
                            <th>DNI</th>
                            <th>Fecha</th>
                            <th>Dominio</th>
                            <th>Alcoholemia</th>
                            <th>Tipo de Infracci√≥n</th>
                            <th>Con Secuestro</th>
                            <th>Estado</th>
                            <th>Valor de Multa</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="export-buttons">
                    <button onclick="exportToExcel('actas')">Exportar a Excel</button>
                    <button onclick="exportToPDF('actas')">Exportar a PDF</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    let accidentesData = JSON.parse(localStorage.getItem('accidentesData')) || [];
    let actasData = JSON.parse(localStorage.getItem('actasData')) || [];
    let editingId = null;
    
    function buscarRegistros() {
        const searchTerm = document.getElementById('searchInput').value.trim();
        const resultsDiv = document.getElementById('searchResults');
        resultsDiv.innerHTML = '';
    
        const accidentes = accidentesData.filter(a =>
            a.dni === searchTerm ||
            a.dominio.toLowerCase() === searchTerm.toLowerCase() ||
            a.numero === searchTerm ||
            (a.participantes && a.participantes.some(p =>
                p.dni === searchTerm ||
                p.dominio.toLowerCase() === searchTerm.toLowerCase()
            ))
        );
    
        const actas = actasData.filter(a =>
            a.dni === searchTerm ||
            a.dominio.toLowerCase() === searchTerm.toLowerCase() ||
            a.numero === searchTerm
        );
    
        let html = '<h3>Resultados de la b√∫squeda:</h3>';
    
        if (accidentes.length > 0) {
            html += '<h4>Accidentes:</h4>';
            accidentes.forEach(acc => {
                let participantesText = '';
                if (acc.participantes && acc.participantes.length > 0) {
                    participantesText = '<br>Participantes: ' + acc.participantes.map(p =>
                        `${p.nombre} (DNI: ${p.dni}, Dominio: ${p.dominio})`
                    ).join(', ');
                }
    
                html += `<p>N√∫mero de Accidente: ${acc.numero} - Nombre: ${acc.nombre} - 
                        Fecha Audiencia: ${acc.fechaAudiencia} - Estado: ${acc.estado} - 
                        Dominio: ${acc.dominio}<br><strong>Valor de Multa: $${acc.valorMulta || 0}</strong>
                        <button onclick="mostrarPago('accidente', '${acc.numero}', '${acc.nombre}', '${acc.dni}', ${acc.valorMulta || 0})" class="pay-button">Pagar</button>${participantesText}</p>`;
            });
        }
    
        if (actas.length > 0) {
            html += '<h4>Actas:</h4>';
            actas.forEach(acta => {
                const alcoholemiaText = acta.alcoholemia === 'S√≠' ?
                    `<span class="alcoholemia-alert">Alcoholemia: ${acta.alcoholemia}</span>` :
                    'Alcoholemia: No';
    
                html += `<p>N√∫mero de Acta: ${acta.numero} - Nombre: ${acta.nombre} - 
                        Fecha: ${acta.fecha} - Infracci√≥n: ${acta.infraccion} - 
                        ${alcoholemiaText} - Dominio: ${acta.dominio}<br>
                        <strong>Valor de Multa: $${acta.valor || 0}</strong>
                        <button onclick="mostrarPago('acta', '${acta.numero}', '${acta.nombre}', '${acta.dni}', ${acta.valor || 0})" class="pay-button">Pagar</button></p>`;
            });
        }
    
        if (accidentes.length === 0 && actas.length === 0) {
            html += '<p>No se encontraron registros.</p>';
        }
    
        resultsDiv.innerHTML = html;
    }
    
    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });
    
        document.getElementById(tabName).style.display = 'block';
    
        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('active');
        });
        document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add('active');
    }
    
    function agregarParticipante() {
        const container = document.getElementById('participantesContainer');
        const participanteRow = document.createElement('div');
        participanteRow.className = 'participante-row';
    
        participanteRow.innerHTML = `
            <input type="text" placeholder="Nombre y Apellido" class="participante-nombre">
            <input type="text" placeholder="DNI" class="participante-dni">
            <input type="text" placeholder="Dominio" class="participante-dominio">
            <button type="button" class="remove-participante" onclick="this.parentElement.remove()">√ó</button>
        `;
    
        container.appendChild(participanteRow);
    }
    
    function mostrarPago(tipo, numero, nombre, dni, valor) {
        const modal = document.createElement('div');
        modal.className = 'payment-modal';
        
        const paymentCode = `${tipo.toUpperCase()}-${numero}-${Date.now()}`;
        
        // Find if it's an acta with secuestro
        let acarreoHtml = '';
        if (tipo === 'acta') {
            const acta = actasData.find(a => a.numero === numero);
            if (acta && acta.secuestro === 'S√≠') {
                acarreoHtml = `
                    <div class="payment-total" style="margin-top: 10px;">
                        <label>Acarreo: $</label>
                        <input type="number" id="montoAcarreo" value="0" style="width: 150px; font-size: 20px; padding: 5px;">
                    </div>
                `;
            }
        }
        
        const content = `
            <div class="payment-content">
                <h2 style="text-align: center; margin-bottom: 5px;">MUNICIPALIDAD DE MAIP√ö</h2>
                <h3 style="text-align: center; margin-top: 0;">JUZGADO VIAL ZONA ESTE</h3>
                <h3>Boleta de Pago - ${tipo.toUpperCase()}</h3>
                
                <div class="payment-details">
                    <p><strong>N√∫mero de ${tipo}:</strong> ${numero}</p>
                    <p><strong>Nombre:</strong> ${nombre}</p>
                    <p><strong>DNI:</strong> ${dni}</p>
                    <p><strong>Fecha:</strong> ${new Date().toLocaleDateString()}</p>
                </div>
    
                <div class="payment-total">
                    <label>Total a Pagar: $</label>
                    <input type="number" id="montoAPagar" value="${valor}" style="width: 150px; font-size: 20px; padding: 5px;">
                </div>
                ${acarreoHtml}
    
                <div class="barcode-container">
                    <p style="margin-bottom: 10px; font-size: 14px;">C√≥digo de Pago:</p>
                    <svg id="barcode"></svg>
                </div>
    
                <div style="text-align: right; margin: 20px 0;">
                    <button type="button" class="print-button" onclick="imprimirBoleta(this)">Imprimir Boleta</button>
                </div>
                
                <div class="payment-form">
                    <h3>Opciones de Pago</h3>
                    <p>Ingrese los datos de su tarjeta:</p>
                    <form id="paymentForm">
                        <div class="form-group">
                            <label>N√∫mero de Tarjeta:</label>
                            <input type="text" required pattern="[0-9]{16}">
                        </div>
                        <div class="form-group">
                            <label>Fecha de Vencimiento:</label>
                            <input type="text" required pattern="[0-9]{2}/[0-9]{2}">
                        </div>
                        <div class="form-group">
                            <label>CVV:</label>
                            <input type="text" required pattern="[0-9]{3,4}">
                        </div>
                        <button type="submit" class="pay-button">Procesar Pago</button>
                    </form>
                </div>
                <button onclick="this.closest('.payment-modal').remove()" style="position: absolute; top: 10px; right: 10px;">√ó</button>
            </div>
        `;
        
        modal.innerHTML = content;
        document.body.appendChild(modal);
    
        JsBarcode("#barcode", paymentCode, {
            format: "CODE128",
            width: 2,
            height: 100,
            displayValue: true
        });
    }
    
    function imprimirBoleta(button) {
        const paymentContent = button.closest('.payment-content');
        const montoAPagar = paymentContent.querySelector('#montoAPagar').value;
        
        const paymentTotal = paymentContent.querySelector('.payment-total');
        paymentTotal.innerHTML = `<div style="font-size: 24px; font-weight: bold;">Total a Pagar: $${montoAPagar}</div>`;
        
        window.print();
    }
    
    function editarRegistro(type, id) {
        editingId = id;
        const data = type === 'accidentes' ? accidentesData[id] : actasData[id];
    
        if (type === 'accidentes') {
            document.getElementById('numeroAccidente').value = data.numero;
            document.getElementById('nombreAccidente').value = data.nombre;
            document.getElementById('dniAccidente').value = data.dni;
            document.getElementById('fechaAccidente').value = data.fecha;
            document.getElementById('lugarAccidente').value = data.lugar;
            document.getElementById('dominioAccidente').value = data.dominio;
            document.getElementById('fechaAudiencia').value = data.fechaAudiencia;
            document.getElementById('asignadaA').value = data.asignada;
            document.getElementById('tipoAccidente').value = data.tipo;
            document.getElementById('estadoAccidente').value = data.estado;
            document.getElementById('valorMultaAccidente').value = data.valorMulta;
    
            document.getElementById('participantesContainer').innerHTML = '';
            data.participantes.forEach(participante => {
                const participanteRow = document.createElement('div');
                participanteRow.className = 'participante-row';
                participanteRow.innerHTML = `
                    <input type="text" value="${participante.nombre}" class="participante-nombre">
                    <input type="text" value="${participante.dni}" class="participante-dni">
                    <input type="text" value="${participante.dominio}" class="participante-dominio">
                    <button type="button" class="remove-participante" onclick="this.parentElement.remove()">√ó</button>
                `;
                document.getElementById('participantesContainer').appendChild(participanteRow);
            });
        } else {
            document.getElementById('numeroActa').value = data.numero;
            document.getElementById('nombreActa').value = data.nombre;
            document.getElementById('dniActa').value = data.dni;
            document.getElementById('fechaActa').value = data.fecha;
            document.getElementById('dominioActa').value = data.dominio;
            document.getElementById('alcoholemiaActa').value = data.alcoholemia;
            document.getElementById('tipoInfraccion').value = data.infraccion;
            document.getElementById('conSecuestro').value = data.secuestro;
            document.getElementById('estadoActa').value = data.estado;
            document.getElementById('valorMulta').value = data.valor;
        }
    }
    
    function eliminarRegistro(type, id) {
        if (confirm('¬øEst√° seguro que desea eliminar este registro?')) {
            if (type === 'accidentes') {
                accidentesData.splice(id, 1);
            } else {
                actasData.splice(id, 1);
            }
            updateTable(type);
            saveToLocalStorage();
        }
    }
    
    function saveToLocalStorage() {
        localStorage.setItem('accidentesData', JSON.stringify(accidentesData));
        localStorage.setItem('actasData', JSON.stringify(actasData));
    }
    
    document.getElementById('accidenteForm').addEventListener('submit', function(e) {
        e.preventDefault();
    
        const participantes = [];
        document.querySelectorAll('.participante-row').forEach(row => {
            participantes.push({
                nombre: row.querySelector('.participante-nombre').value,
                dni: row.querySelector('.participante-dni').value,
                dominio: row.querySelector('.participante-dominio').value
            });
        });
    
        const falloPdf = document.getElementById('falloPdf').files[0];
    
        if (falloPdf) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const pdfUrl = event.target.result;
    
                const accidente = {
                    numero: document.getElementById('numeroAccidente').value,
                    nombre: document.getElementById('nombreAccidente').value,
                    dni: document.getElementById('dniAccidente').value,
                    fecha: document.getElementById('fechaAccidente').value,
                    lugar: document.getElementById('lugarAccidente').value,
                    dominio: document.getElementById('dominioAccidente').value,
                    fechaAudiencia: document.getElementById('fechaAudiencia').value,
                    asignada: document.getElementById('asignadaA').value,
                    tipo: document.getElementById('tipoAccidente').value,
                    estado: document.getElementById('estadoAccidente').value,
                    valorMulta: document.getElementById('valorMultaAccidente').value,
                    fallo: pdfUrl,
                    participantes: participantes 
                };
    
                if (editingId !== null) {
                    accidentesData[editingId] = accidente;
                    editingId = null;
                } else {
                    accidentesData.push(accidente);
                }
    
                updateTable('accidentes');
                saveToLocalStorage();
                e.target.reset();
                document.getElementById('falloPdf').value = '';
                document.getElementById('participantesContainer').innerHTML = '';
            };
            reader.readAsDataURL(falloPdf);
        } else {
            const accidente = {
                numero: document.getElementById('numeroAccidente').value,
                nombre: document.getElementById('nombreAccidente').value,
                dni: document.getElementById('dniAccidente').value,
                fecha: document.getElementById('fechaAccidente').value,
                lugar: document.getElementById('lugarAccidente').value,
                dominio: document.getElementById('dominioAccidente').value,
                fechaAudiencia: document.getElementById('fechaAudiencia').value,
                asignada: document.getElementById('asignadaA').value,
                tipo: document.getElementById('tipoAccidente').value,
                estado: document.getElementById('estadoAccidente').value,
                valorMulta: document.getElementById('valorMultaAccidente').value,
                fallo: '',
                participantes: participantes 
            };
    
            if (editingId !== null) {
                accidentesData[editingId] = accidente;
                editingId = null;
            } else {
                accidentesData.push(accidente);
            }
    
            updateTable('accidentes');
            saveToLocalStorage();
            e.target.reset();
            document.getElementById('participantesContainer').innerHTML = '';
        }
    });
    
    document.getElementById('actaForm').addEventListener('submit', function(e) {
        e.preventDefault();
    
        const acta = {
            numero: document.getElementById('numeroActa').value,
            nombre: document.getElementById('nombreActa').value,
            dni: document.getElementById('dniActa').value,
            fecha: document.getElementById('fechaActa').value,
            dominio: document.getElementById('dominioActa').value,
            alcoholemia: document.getElementById('alcoholemiaActa').value,
            infraccion: document.getElementById('tipoInfraccion').value,
            secuestro: document.getElementById('conSecuestro').value,
            estado: document.getElementById('estadoActa').value,
            valor: document.getElementById('valorMulta').value
        };
    
        if (editingId !== null) {
            actasData[editingId] = acta;
            editingId = null;
        } else {
            actasData.push(acta);
        }
    
        updateTable('actas');
        saveToLocalStorage();
        e.target.reset();
    });
    
    function updateTable(type) {
        const table = document.getElementById(`${type}Table`).getElementsByTagName('tbody')[0];
        table.innerHTML = '';
    
        const data = type === 'accidentes' ? accidentesData : actasData;
    
        data.forEach((item, index) => {
            const row = table.insertRow();
    
            if (type === 'accidentes') {
                row.className = item.estado.toLowerCase().replace(/ /g, '-');
                
                row.insertCell().textContent = item.numero || '';
    
                const nombreCell = row.insertCell();
                nombreCell.textContent = item.nombre || '';
                if (item.participantes && item.participantes.length > 0) {
                    const participantesList = document.createElement('div');
                    participantesList.className = 'participantes-list';
                    participantesList.innerHTML = item.participantes.map(p =>
                        `${p.nombre}`
                    ).join('<br>');
                    nombreCell.appendChild(participantesList);
                }
    
                const dniCell = row.insertCell();
                dniCell.textContent = item.dni || '';
                if (item.participantes && item.participantes.length > 0) {
                    const dniList = document.createElement('div');
                    dniList.className = 'participantes-list';
                    dniList.innerHTML = item.participantes.map(p =>
                        `${p.dni}`
                    ).join('<br>');
                    dniCell.appendChild(dniList);
                }
    
                row.insertCell().textContent = item.fecha || '';
                row.insertCell().textContent = item.lugar || '';
    
                const dominioCell = row.insertCell();
                dominioCell.textContent = item.dominio || '';
                if (item.participantes && item.participantes.length > 0) {
                    const dominioList = document.createElement('div');
                    dominioList.className = 'participantes-list';
                    dominioList.innerHTML = item.participantes.map(p =>
                        `${p.dominio}`
                    ).join('<br>');
                    dominioCell.appendChild(dominioList);
                }
    
                row.insertCell().textContent = item.fechaAudiencia || '';
                row.insertCell().textContent = item.asignada || '';
                row.insertCell().textContent = item.tipo || '';
                row.insertCell().textContent = item.estado || '';
                row.insertCell().textContent = item.valorMulta || 0;
    
                const pdfCell = row.insertCell();
                if (item.fallo) {
                    const link = document.createElement('a');
                    link.href = 'javascript:void(0);';
                    link.textContent = 'PDF';
                    link.onclick = () => {
                        const modal = document.createElement('div');
                        modal.style.cssText = `
                            position: fixed;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: rgba(0,0,0,0.8);
                            z-index: 1000;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                        `;
    
                        const closeBtn = document.createElement('button');
                        closeBtn.textContent = '√ó';
                        closeBtn.style.cssText = `
                            position: absolute;
                            top: 10px;
                            right: 10px;
                            background: white;
                            border: none;
                            font-size: 24px;
                            cursor: pointer;
                            padding: 5px 10px;
                            border-radius: 5px;
                        `;
                        closeBtn.onclick = () => modal.remove();
    
                        const viewer = document.createElement('iframe');
                        viewer.src = item.fallo;
                        viewer.style.cssText = `
                            width: 90%;
                            height: 90%;
                            border: none;
                            background: white;
                        `;
    
                        modal.appendChild(closeBtn);
                        modal.appendChild(viewer);
                        document.body.appendChild(modal);
                    };
                    pdfCell.appendChild(link);
                }
            } else {
                row.className = item.estado.toLowerCase().replace(/ /g, '-');
    
                Object.values(item).forEach(value => {
                    row.insertCell().textContent = value || '';
                });
            }
    
            const actionsCell = row.insertCell();
            const editButton = document.createElement('button');
            editButton.textContent = 'Editar';
            editButton.className = 'edit-button';
            editButton.onclick = () => editarRegistro(type, index);
            actionsCell.appendChild(editButton);
    
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = 'üóëÔ∏è';
            deleteButton.className = 'delete-button';
            deleteButton.onclick = () => eliminarRegistro(type, index);
            actionsCell.appendChild(deleteButton);
        });
    }
    
    function exportToExcel(type) {
        const data = type === 'accidentes' ? accidentesData : actasData;
    
        const formattedData = data.map(item => {
            const exportItem = { ...item };
            if (exportItem.fallo) delete exportItem.fallo;
            return exportItem;
        });
    
        const ws = XLSX.utils.json_to_sheet(formattedData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, type === 'accidentes' ? "Accidentes" : "Actas");
    
        try {
            XLSX.writeFile(wb, `registro_${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
        } catch (error) {
            console.error('Error exporting to Excel:', error);
            alert('Error al exportar a Excel. Por favor intente nuevamente.');
        }
    }
    
    function exportToPDF(type) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
    
        const data = type === 'accidentes' ? accidentesData : actasData;
    
        doc.text(`Registro de ${type}`, 10, 10);
    
        let y = 30;
        data.forEach((item, index) => {
            const text = Object.entries(item).map(([key, value]) => `${key}: ${value}`).join(', ');
            doc.text(text, 10, y);
            y += 10;
        });
    
        doc.save(`${type}.pdf`);
    }
    
    function updatePrintStyles() {
      const styleTag = document.createElement('style');
      styleTag.textContent = `
        @media print {
          body * {
            visibility: hidden;
          }
          .payment-content, .payment-content * {
            visibility: visible;
          }
          .payment-content {
            position: absolute;
            left: 0;
            top: 0;
          }
          .payment-form, .print-button, .payment-content > button:last-child {
            display: none !important;  
          }
          .barcode-container {
            display: block !important;
            visibility: visible !important;
            margin-bottom: 30px;
          }
          #montoAPagar {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            border: none;
          }
        }
      `;
      document.head.appendChild(styleTag);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        updatePrintStyles();
        updateTable('accidentes');
        updateTable('actas');
    });
    </script>
    </body>
    </html>